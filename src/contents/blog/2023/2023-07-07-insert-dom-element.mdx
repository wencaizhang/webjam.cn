---
title: 'JS æ’å…¥ DOM å…ƒç´ '
slug: insert-dom-element
date: '2023-07-07'
draft: false
summary: 'è™½ç„¶ç°åœ¨ Vue/React è¿™äº›æ¡†æ¶å·²ç»éš”ç¦»äº†å¯¹ DOM çš„æ“ä½œï¼Œä½†æ—¶ä¸æ—¶åœ°è¿˜æ˜¯ä¼šéœ€è¦ç›´æ¥ä½¿ç”¨ JS æ’å…¥ DOM å…ƒç´ ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ç­‰ç”¨åˆ°çš„æ—¶å€™ç›´æ¥è¿‡æ¥æŸ¥å³å¯ã€‚'
featured_image_url: 'https://static.webjam.cn/images/logos/js.svg'
tags:
  - JavaScript
---

è™½ç„¶ç°åœ¨ Vue/React è¿™äº›æ¡†æ¶å·²ç»éš”ç¦»äº†å¯¹ DOM çš„æ“ä½œï¼Œä½†æ—¶ä¸æ—¶åœ°è¿˜æ˜¯ä¼šéœ€è¦ç›´æ¥ä½¿ç”¨ JS æ’å…¥ DOM å…ƒç´ ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ç­‰ç”¨åˆ°çš„æ—¶å€™ç›´æ¥è¿‡æ¥æŸ¥å³å¯ã€‚

## æ’å…¥å­å…ƒç´ ï¼š`appendChild` æ–¹æ³•

æèµ·æ’å…¥ DOM å…ƒç´ ï¼Œä¼°è®¡å¤§å®¶è„‘æµ·é‡Œç¬¬ä¸€ä¸ªæƒ³èµ·æ¥çš„å°±æ˜¯ `appendChild` æ–¹æ³•äº†ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªå…ƒç´ çš„å†…éƒ¨ã€‚

å› ä¸ºå¾ˆç†Ÿæ‚‰äº†ï¼Œå°±ä¸å¤šè¯´ï¼Œç›´æ¥æ¥ä¸ªç¤ºä¾‹ï¼š

```js
// åˆ›å»ºä¸€ä¸ªæ–°çš„æ®µè½å…ƒç´  <p>ï¼Œç„¶åæ·»åŠ åˆ° <body> çš„æœ€å°¾éƒ¨
var p = document.createElement('p');
document.body.appendChild(p);
```

## ä¸€ã€æ’åˆ°æŸå…ƒç´ å‰é¢ï¼š `insertBefore()` æ–¹æ³•

> [Node.insertBefore() - Web API æ¥å£å‚è€ƒ | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/API/Node/insertBefore)

insertBefore()æ–¹æ³•,å¯ä»¥å®ç°æŠŠä¸€ä¸ªæ–°å…ƒç´ æ’å…¥åˆ°ç°åœ¨å…ƒç´ çš„å‰é¢ï¼Œä¸ç°æœ‰å…ƒç´ å½¢æˆå…„å¼Ÿå…³ç³»ã€‚

è¯­æ³•æ˜¯ï¼š

```js
var insertedNode = parentNode.insertBefore(newNode, targetElement);
```

- newNode: è¦æ’å…¥çš„æ–°å…ƒç´ ï¼ˆå­å…ƒç´ ï¼‰
- targetElement: å·²å­˜åœ¨çš„å…ƒç´ ï¼Œæ–°å…ƒç´ å°†æ’å…¥åˆ°è¿™ä¸ªå·²å­˜åœ¨å…ƒç´ ä¹‹å‰
- parentNode: targetElement çš„çˆ¶å…ƒç´ 

ä½†æ˜¯è¿™ä¸ªå‡½æ•°ä½¿ç”¨èµ·æ¥ç•¥å¾®éº»çƒ¦ï¼Œå› ä¸ºåœ¨è°ƒç”¨ä¹‹å‰éœ€è¦è®¡ç®— `parentNode`ï¼Œè€Œ `parentNode` ä¸€å®šæ˜¯ `targetElement` çš„çˆ¶å…ƒç´ ï¼Œå…¶å®æ˜¯å¯ä»¥çœç•¥æ‰çš„ã€‚

æ‰€ä»¥æˆ‘å°è£…äº†ä¸€å±‚ï¼Œåªéœ€è¦ä¼ å…¥æ–°å…ƒç´ å’Œç›®æ ‡å…ƒç´ å³å¯ï¼š

```js
function myInsertBefore(newNode, targetElement) {
  const parentNode = targetElement.parentNode;
  const insertedNode = parentNode.insertBefore(newNode, targetElement);
  return insertedNode;
}
```

æˆ–è€…ä½ å–œæ¬¢æç®€ç‰ˆæœ¬ï¼š

```js
function myInsertBefore(newNode, targetElement) {
  return targetElement.parentNode.insertBefore(newNode, targetElement);
}
```

## äºŒã€æ’åˆ°æŸå…ƒç´ ä¹‹åï¼š `insertAfter()` è‡ªå®šä¹‰å‡½æ•°

ç”±äºæ²¡æœ‰æä¾›å¯¹åº”çš„å‡½æ•°ï¼Œè€Œä¸”å› ä¸ºè¿™æ ·çš„é€»è¾‘è¿˜æŒºå¸¸è§ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¿…è¦è‡ªå·±å°è£…ä¸€ä¸ªã€‚

æ’å…¥åˆ°æŸå…ƒç´ ä¹‹åï¼Œç›¸å½“äºæ’å…¥åˆ°è¯¥å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ä¹‹å‰ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å°è£…ï¼š

```js
// æ­¤æ–¹æ³•ä¸æ¨èï¼Œå› ä¸ºä¸‹é¢æœ‰æ›´å¥½çš„æ–¹æ³•
function myInsertAfter(newElement, targetElement) {
  var parent = targetElement.parentNode;
  if (parent.lastChild == targetElement) {
    parent.appendChild(newElement);
  } else {
    parent.insertBefore(newElement, targetElement.nextSibling);
  }
}
```

ä¸Šé¢ä»£ç åˆ¤æ–­äº†æ’å…¥ä½ç½®æ˜¯å¦åœ¨æœ€åï¼Œå¦‚æœåœ¨æœ€åå°±ä½¿ç”¨ `appendChild` æ’å…¥ã€‚

åæ¥å‘ç°å…¶å®ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼ŒåŸç”Ÿçš„ `insertBefore` æ–¹æ³•å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸º `null` ä¹Ÿä¼šè‡ªåŠ¨æ’å…¥åˆ°çˆ¶å…ƒç´ çš„æœ€åä½ç½®ï¼Œå…¶ç»“æœä¹Ÿç¬¦åˆé¢„æœŸï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ä¸‹é¢è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼š

```js
function myInsertAfter(newElement, targetElement) {
  return targetElement.parentNode.insertBefore(
    newElement,
    targetElement.nextSibling
  );
}
```

## ä¸‰ã€æ’å…¥ä½ç½®æ›´çµæ´»çš„ `insertAdjacentHTML()` æ–¹æ³•

ä¸Šé¢ä»‹ç»äº†ä¸‰ç§æ’å…¥ DOM çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯åœ¨çˆ¶å…ƒç´ çš„æœ€åä½ç½®æ’å…¥å­å…ƒç´ ï¼Œåœ¨æŸä¸ªå…ƒç´ ä¹‹å‰æ’å…¥ï¼Œåœ¨æŸä¸ªå…ƒç´ ä¹‹åæ’å…¥ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒéº»çƒ¦ï¼Œé‚£å°±æ˜¯åˆ›å»ºæ–°å…ƒç´ çš„ä»£ç æ¯”è¾ƒç¹çã€‚

æ¯”å¦‚æˆ‘è¦åˆ›å»ºä¸€ä¸ªé“¾æ¥éœ€è¦è¿™æ ·å†™ï¼š

```js
// 1 åˆ›å»º
let dom = document.createElement('a');
// 2 è®¾ç½® class
dom.classList.add('back-to-home');
// 3 è®¾ç½®å†…å®¹
dom.textContent = 'å›åˆ°é¦–é¡µ';
// 4 è®¾ç½®å±æ€§
dom.setAttribute('href', '_self');
// 5 æ’å…¥
document.body.appendChild(dom);
```

å¯ä»¥çœ‹åˆ°åˆ›å»ºå®Œæˆéœ€è¦ 4 æ­¥ï¼Œç„¶åæ‰èƒ½è°ƒç”¨ `appendChild` æ’å…¥ã€‚å®é™…ä¸Šå…·ä½“ä»£ç é‡å…¶å®éšç€éœ€è¦è®¾ç½®çš„å±æ€§æ•°é‡è€Œå˜åŒ–ï¼Œå±æ€§è¶Šå¤šï¼Œä»£ç é‡è¶Šå¤šï¼Œè¿™è®©ä½¿ç”¨è¿‡ jQuery çš„åŒå­¦éƒ½ä¼šæ„Ÿè§‰åˆ°ä¸çˆ½ï¼Œæ¯•ç«Ÿä¸€è¡Œ jQuery ä»£ç å°±èƒ½æå®šï¼š

```js
// ä½¿ç”¨ jQuery
$('body').append('<a class="back-to-home" href="_self">å›åˆ°é¦–é¡µ</a>');
```

_ä¸å¾—ä¸è¯´ jQuery çœŸå¥½ç”¨ ğŸ˜„_

ä¸è¿‡åæ¥æˆ‘å‘ç°åŸç”Ÿçš„ JS é‡Œé¢ä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•: [element.insertAdjacentHTML - Web API æ¥å£å‚è€ƒ | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/insertAdjacentHTML)ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æ’å…¥ä»»æ„ä½ç½®å¹¶ä¸”èƒ½å¤Ÿå°†å­—ç¬¦ä¸²è§£æä¸º DOM å…ƒç´ ã€‚

è¯­æ³•å¦‚ä¸‹ï¼š

```js
element.insertAdjacentHTML(position, text);
```

**`insertAdjacentHTML()`** æ–¹æ³•å‚æ•° `text` è§£æä¸º DOM å…ƒç´ ï¼Œå¹¶æ ¹æ® `position` æŒ‡å®šçš„ä½ç½®æ’å…¥åˆ° DOM æ ‘ä¸­ã€‚

è€Œä¸”å®ƒä¸ä¼šé‡æ–°è§£æå®ƒæ­£åœ¨ä½¿ç”¨çš„å…ƒç´ ï¼Œå› æ­¤å®ƒä¸ä¼šç ´åå…ƒç´ å†…çš„ç°æœ‰å…ƒç´ ã€‚è¿™é¿å…äº†é¢å¤–çš„åºåˆ—åŒ–æ­¥éª¤ï¼Œä½¿å…¶æ¯”ç›´æ¥ä½¿ç”¨ innerHTML æ“ä½œæ›´å¿«ã€‚

å‚æ•° `position` è¡¨ç¤ºæ’å…¥å†…å®¹ç›¸å¯¹äºå…ƒç´ çš„ä½ç½®ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ä»¥ä¸‹å­—ç¬¦ä¸²ä¹‹ä¸€ï¼š

- `beforebegin`ï¼šå…ƒç´ è‡ªèº«çš„å‰é¢ã€‚
- `afterbegin`ï¼šæ’å…¥å…ƒç´ å†…éƒ¨çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹å‰ã€‚
- `beforeend`ï¼šæ’å…¥å…ƒç´ å†…éƒ¨çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹åã€‚
- `afterend`ï¼šå…ƒç´ è‡ªèº«çš„åé¢ã€‚

> å¤‡æ³¨ï¼š beforebegin å’Œ afterend ä½ç½®ï¼Œä»…åœ¨èŠ‚ç‚¹åœ¨æ ‘ä¸­ä¸”èŠ‚ç‚¹å…·æœ‰ä¸€ä¸ª parent å…ƒç´ æ—¶å·¥ä½œã€‚

```html
<!-- beforebegin å…ƒç´ è‡ªèº«çš„å‰é¢ -->
<p>
  <!-- afterbegin å…ƒç´ å†…éƒ¨çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹å‰ -->
  foo
  <!-- beforeend å…ƒç´ å†…éƒ¨çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹ä¹‹å -->
</p>
<!-- afterend å…ƒç´ è‡ªèº«çš„åé¢ -->
```

å¦å¤–ä¸€ä¸ªå‚æ•° `text` å°±å®¹æ˜“ç†è§£äº†ï¼Œå®ƒæ˜¯èƒ½å¤Ÿè¢«è§£æä¸º HTML æˆ– XML å…ƒç´ çš„å­—ç¬¦ä¸²ã€‚

æ¥ä¸ªä¾‹å­ ğŸŒ° çœ‹çœ‹ï¼š

```js
// åŸä¸º <div id="one">one</div>

var d1 = document.getElementById('one');
d1.insertAdjacentHTML('afterend', '<div id="two">two</div>');

// æ­¤æ—¶ï¼Œæ–°ç»“æ„å˜æˆï¼š
// <div id="one">one</div>
// <div id="two">two</div>
```

ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„å®‰å…¨é—®é¢˜ï¼šå¦‚æœä½ å¾— `text` å‚æ•°æ¥è‡ªç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œè¦è®°å¾—è½¬ä¹‰ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚

å¦‚æœåªæ˜¯ä¸ºäº†æ’å…¥æ–‡æœ¬å†…å®¹ï¼ˆè€Œä¸æ˜¯ HTML èŠ‚ç‚¹ï¼‰ï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå»ºè®® [`node.insertAdjacentText()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/insertAdjacentText)ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯ `insertAdjacentText` ä¸éœ€è¦ç»è¿‡ HTML è§£é‡Šå™¨çš„è½¬æ¢ï¼Œæ€§èƒ½ä¼šå¥½ä¸€ç‚¹ã€‚

## å››ã€æ€»ç»“

è¿™æ ·æˆ‘ä»¬å°±äº†è§£äº†å„ç§å„æ ·çš„æ’å…¥ DOM å…ƒç´ çš„æ–¹æ³•ï¼Œä»¥ååœ¨æ²¡æœ‰ jQuery çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å¾ˆå¿«å®ç°æ’å…¥å…ƒç´ çš„åŠŸèƒ½äº†ã€‚
